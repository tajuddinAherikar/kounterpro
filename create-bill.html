<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Create Invoice - Keen Batteries</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700;900&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>ðŸ“„ Create New Invoice</h1>
        </header>

        <div class="nav-section">
            <button class="btn-nav" onclick="window.location.href='index.html'"><span class="material-icons">arrow_back</span> Dashboard</button>
            <button class="btn-nav" onclick="window.location.href='inventory.html'"><span class="material-icons">inventory_2</span> Inventory</button>
        </div>

        <form id="invoiceForm" class="invoice-form">
            <div class="form-section">
                <h2>Customer Details</h2>
                <div class="form-row">
                    <label>
                        Customer Name: <span class="required">*</span>
                        <input type="text" id="customerName" required minlength="2" maxlength="100" placeholder="Enter customer name">
                    </label>
                </div>
                <div class="form-row">
                    <label>
                        Customer Mobile Number: <span class="required">*</span>
                        <input type="tel" id="customerMobile" placeholder="e.g., 9876543210" pattern="[0-9]{10}" minlength="10" maxlength="10" required>
                    </label>
                    <small style="color: #666;">10-digit mobile number starting with 6-9 (for WhatsApp)</small>
                </div>
                <div class="form-row">
                    <label>
                        Customer Address: <span class="required">*</span>
                        <textarea id="customerAddress" rows="3" required minlength="5" maxlength="255" placeholder="Enter complete address"></textarea>
                    </label>
                </div>
                <div class="form-row">
                    <label>
                        Customer GST No: <span class="optional">(optional)</span>
                        <input type="text" id="customerGST" placeholder="e.g., 22AAAAA0000A1Z5" maxlength="15" pattern="[0-9]{2}[A-Z]{5}[0-9]{4}[A-Z]{1}[1-9A-Z]{1}Z[0-9A-Z]{1}" style="text-transform: uppercase;">
                    </label>
                    <small style="color: #666;">15-character GST number (optional)</small>
                </div>
            </div>

            <div class="form-section">
                <h2>Invoice Items</h2>
                <div class="gst-control">
                    <label>
                        GST Rate (%):
                        <input type="number" id="gstRate" value="18" min="0" max="50" step="0.01">
                    </label>
                    <small style="color: #666; margin-left: 10px;">Rate inclusive pricing (0-50%)</small>
                </div>
                <div class="table-wrapper">
                    <table class="items-table">
                        <thead>
                            <tr>
                                <th style="width: 60px;">Sl No</th>
                                <th>Description of Goods <span style="font-weight: normal; font-size: 11px;">(start typing to search inventory)</span></th>
                                <th style="width: 180px;">Serial No(s) <span style="font-weight: normal; font-size: 11px;">(Optional, one per line)</span></th>
                                <th style="width: 100px;">Quantity</th>
                                <th style="width: 140px;">Rate (â‚¹) <span style="font-weight: normal; font-size: 11px;">(incl. GST)</span></th>
                                <th style="width: 140px;">Amount (â‚¹)</th>
                                <th style="width: 80px;">Action</th>
                            </tr>
                        </thead>
                        <tbody id="itemsTableBody">
                            <tr class="item-row" data-row="1">
                                <td>1</td>
                                <td><input type="text" class="item-description" required></td>
                                <td><textarea class="item-serial" rows="1" placeholder="Optional"></textarea></td>
                                <td><input type="number" class="item-quantity" min="1" value="1" required></td>
                                <td><input type="number" class="item-rate" min="0" step="0.01" required></td>
                                <td class="item-amount">0.00</td>
                                <td><button type="button" class="btn-remove" onclick="removeItem(1)">âœ•</button></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <button type="button" class="btn-secondary" onclick="addItem()">+ Add Item</button>

                <div class="totals-section">
                    <div class="total-row">
                        <span>Subtotal:</span>
                        <span id="subtotal">â‚¹0.00</span>
                    </div>
                    <div class="total-row">
                        <span>GST (<span id="displayGstRate">18</span>%):</span>
                        <span id="gstAmount">â‚¹0.00</span>
                    </div>
                    <div class="total-row grand-total">
                        <span>Grand Total:</span>
                        <span id="grandTotal">â‚¹0.00</span>
                    </div>
                </div>
            </div>

            <div class="form-section">
                <h2>Terms & Conditions</h2>
                <textarea id="termsConditions" rows="6">1. Payment should be made on delivery.
2. Goods once sold will not be taken back or exchanged.
3. Warranty on all peripherals/parts is as per manufacturer's policy and shall be got done no claim will be entertained by the firm for any loss arising from damage, shortage & or non-delivery of the goods afterwards.
4. Our responsibility ceases the moment goods leave our premises.
5. No claim will be entertained by the firm for any loss arising from damage, shortage & or non-delivery of the goods afterwards.</textarea>
            </div>

            <div class="form-actions">
                <button type="button" class="btn-secondary" onclick="window.location.href='index.html'">Cancel</button>
                <button type="submit" class="btn-primary" id="submitBtn"><span class="material-icons">save</span> Save Invoice</button>
            </div>
        </form>

        <!-- WhatsApp Modal -->
        <div id="whatsappModal" class="modal" style="display: none;">
            <div class="modal-content">
                <h2>âœ… Invoice Generated Successfully!</h2>
                <p>Invoice <strong id="modalInvoiceNo"></strong> has been created and downloaded.</p>
                <div class="info-box" style="background-color: #fff3cd; border-left: 4px solid #ffc107; padding: 12px; margin: 16px 0; border-radius: 4px;">
                    <p style="margin: 0; font-size: 14px; color: #856404;">
                        <span class="material-icons" style="vertical-align: middle; font-size: 18px; margin-right: 4px;">info</span>
                        <strong>Note:</strong> The PDF has been downloaded. When you click "Send via WhatsApp", remember to manually attach the PDF file before sending.
                    </p>
                </div>
                <div class="modal-actions">
                    <button class="btn-whatsapp" id="sendWhatsappBtn">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="white" style="vertical-align: middle; margin-right: 8px;">
                            <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413z"/>
                        </svg>
                        Send via WhatsApp
                    </button>
                    <button class="btn-secondary" onclick="closeWhatsappModal()">Done</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>    <script src="validation.js"></script>    <script src="supabase.js"></script>
    <script src="auth.js"></script>
    <script src="billing.js"></script>
</body>
</html>
